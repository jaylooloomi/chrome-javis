# ⚙️ 設定頁面 (Settings.html) - 使用說明

## 📍 快速訪問

### 方式 1: 直接 URL
在 Chrome 地址欄輸入：
```
chrome-extension://YOUR_EXTENSION_ID/settings.html
```

### 方式 2: 從 manifest.json 設置
將 settings.html 設為 options 頁面（待實現）

---

## 🎯 功能概覽

settings.html 整合了兩個重要功能頁面：

### 📋 頁籤 1：設定選項
提供全面的配置管理界面

| 分類 | 功能 | 說明 |
|------|------|------|
| **API 設定** | 模型選擇 | Google Gemini 或本地 Ollama |
| | API 金鑰 | 設置 API 認證 |
| | 基礎 URL | 配置 API 端點 |
| **快捷鍵設定** | 查看快捷鍵 | 顯示已配置的快捷鍵列表 |
| | 自訂位置 | 提示在 chrome://extensions/shortcuts 自訂 |
| **功能偏好** | 主題 | 淺色/深色/自動 |
| | 語言 | 繁體中文/簡體中文/English |
| **進階設定** | 緩存大小 | 設置緩存限制 (MB) |
| | 請求超時 | 設置超時時間 (秒) |
| **工具** | 重置 | 恢復所有設定為預設值 |
| | 匯出 | 將設定導出為 JSON 文件 |
| | 匯入 | 從 JSON 文件導入設定 |

### 📊 頁籤 2：緩存歷史
直接查看和管理 AI 推理結果緩存

| 功能 | 說明 |
|------|------|
| **統計卡片** | 顯示總緩存數、最近記錄、最大容量 |
| **控制按鈕** | 刷新數據、清空緩存 |
| **緩存列表** | 顯示最近 10 條緩存記錄 |
| **詳細信息** | 每條包含輸入、技能、參數、時間 |

---

## 🎮 使用流程

### 流程 1: 配置 API
1. 打開 settings.html
2. 切換到"設定選項"頁籤
3. 在"API 設定"部分：
   - 選擇 AI 模型 (Gemini 或 Ollama)
   - 輸入 API 金鑰
   - 設置 API 基礎 URL
4. 點擊"💾 保存設定"

### 流程 2: 檢查緩存
1. 打開 settings.html
2. 點擊"缓存历史"頁籤
3. 查看統計卡片中的數據
4. 浏覽最近的緩存記錄
5. 點擊"🔄 刷新數據"以更新

### 流程 3: 清理緩存
1. 打開 settings.html
2. 切換到"缓存历史"頁籤
3. 點擊"🗑️ 清空緩存"
4. 確認刪除操作
5. 所有緩存被清除

### 流程 4: 備份和恢復設定
**導出設定：**
1. 切換到"設定選項"頁籤
2. 點擊"📥 匯出設定"按鈕
3. 保存生成的 JSON 文件

**導入設定：**
1. 切換到"設定選項"頁籤
2. 點擊"📤 匯入設定"按鈕
3. 選擇之前匯出的 JSON 文件
4. 設定會自動恢復

---

## 🎨 UI 設計亮點

### 頁籤導航
- 清晰的頁籤按鈕，支持滑鼠懸停效果
- 平滑的內容切換動畫 (淡入效果)
- 當前選中的頁籤會高亮顯示

### 響應式布局
- **桌面 (1024px+)**: 全寬顯示，最優視覺
- **平板 (768px-1023px)**: 適配中等屏幕
- **手機 (< 768px)**: 單列布局，操作優化

### 樣式一致性
- 延續 options.html 的綠色主題 (#28a745)
- 使用相同的卡片、按鈕、狀態消息樣式
- 參考 cache-history.html 的統計卡片設計

### 交互反饋
- 表單保存成功顯示綠色提示
- 錯誤操作顯示紅色警告
- 加載狀態顯示旋轉動畫
- 按鈕悬停有視覺效果

---

## 💾 數據持久化

### 保存位置
所有設定保存到 **Chrome Storage API** (`chrome.storage.sync`)
- 自動同步到用户的 Google 賬戶
- 跨設備同步 (如果登錄相同的 Google 賬戶)

### 包含的設定
```javascript
{
    aiModel: 'gemini' | 'ollama',
    apiKey: 'your-api-key',
    apiBase: 'http://localhost:11434',
    theme: 'light' | 'dark' | 'auto',
    language: 'zh-TW' | 'zh-CN' | 'en',
    cacheSize: '100', // MB
    timeout: '30'     // seconds
}
```

---

## 🔗 頁籤內容詳解

### 設定選項 - API 設定
```
🔑 API 設定
├─ 選擇 AI 模型
│  ├─ Google Gemini (推薦用於在線使用)
│  └─ Ollama (用於本地離線環境)
├─ API 金鑰 (輸入框)
├─ API 基礎 URL (輸入框)
└─ 💾 保存設定 (按鈕)
```

**提示：**
- Gemini 金鑰獲取：訪問 https://aistudio.google.com
- Ollama 默認地址：http://localhost:11434

### 設定選項 - 快捷鍵設定
顯示當前配置的快捷鍵（只讀）：
- Alt + A: 打開 SidePanel
- Alt + S: 總結頁面
- Alt + O: 打開新標籤

⚙️ 自訂位置：chrome://extensions/shortcuts

### 設定選項 - 功能偏好
```
🎨 功能偏好
├─ 主題選擇
│  ├─ 淺色模式
│  ├─ 深色模式
│  └─ 自動 (跟隨系統)
└─ 語言選擇
   ├─ 繁體中文 (默認)
   ├─ 簡體中文
   └─ English
```

### 設定選項 - 進階設定
```
⚡ 進階設定
├─ 緩存大小限制 (數字輸入，MB)
├─ 請求超時 (數字輸入，秒)
├─ ⚠️ 警告信息 (不建議修改)
├─ 🔄 重置為預設值 (按鈕)
├─ 📥 匯出設定 (按鈕)
└─ 📤 匯入設定 (按鈕)
```

### 緩存歷史 - 統計卡片
```
┌──────────────┬──────────────┬──────────────┐
│ 總緩存數     │ 最近記錄     │ 最大容量     │
│   (紫)       │   (粉紅)     │   (青)       │
└──────────────┴──────────────┴──────────────┘
```

### 緩存歷史 - 控制和列表
```
🔄 刷新數據  🗑️ 清空緩存
───────────────────────────
📋 最近 10 條緩存
│
├─ #1 "用户查詢文本"
│  ├─ 技能：skill_name
│  ├─ 參數：{...}
│  └─ ⏱️ 時間
│
├─ #2 ...
└─ ...
```

---

## 🛠️ 開發者注意事項

### 頁籤切換實現
```javascript
// 點擊時自動觸發
button.addEventListener('click', (e) => {
    const tabName = e.target.getAttribute('data-tab');
    switchTab(tabName);
});

// switchTab() 函數處理：
// 1. 隱藏所有內容
// 2. 移除所有按鈕的 active 類
// 3. 顯示選中的內容
// 4. 標記按鈕為 active
// 5. 如果是緩存頁籤，自動加載數據
```

### 數據加載流程
```
用户點擊"缓存历史"頁籤
    ↓
switchTab('cache') 觸發
    ↓
loadCacheHistory() 執行
    ↓
發送 get_cache_stats 消息
    ↓
Service Worker 返回數據
    ↓
updateCacheStats() 更新統計
renderCacheList() 渲染列表
    ↓
用户看到最新數據
```

### 設定保存流程
```
用户填寫表單
    ↓
點擊"保存設定"
    ↓
saveSettings() 讀取表單值
    ↓
chrome.storage.sync.set() 保存
    ↓
showStatus() 顯示成功提示
    ↓
3秒後自動隱藏提示
```

---

## 📱 響應式表現

### 屏幕寬度 1024px+
- 三個統計卡片並排顯示
- 兩列網格布局
- 全寬按鈕組

### 屏幕寬度 768px-1023px
- 統計卡片自動換行
- 表單欄位最優寬度
- 按鈕自動調整大小

### 屏幕寬度 < 768px
- 單列布局
- 統計卡片堆疊
- 按鈕全寬顯示
- 字體自動縮小
- 滾動友好

---

## ⌨️ 快捷鍵

### 頁面交互
- **Tab 鍵**: 在表單控件間導航
- **Enter 鍵**: 激活按鈕或提交表單
- **Ctrl+S**: 快速保存 (如果實現)

### 瀏覽器快捷鍵
- **Alt + A**: 打開 SidePanel (已配置)
- **Alt + S**: 總結頁面 (已配置)
- **Alt + O**: 打開新標籤 (已配置)

---

## 🔐 安全性

### 數據安全
- ✅ API 金鑰存儲在 Chrome Storage (加密)
- ✅ HTML 轉義防止 XSS
- ✅ 表單驗證，防止無效輸入
- ✅ 清空緩存前確認對話框

### 隱私保護
- ✅ 不與任何第三方分享設定
- ✅ 可隨時匯出和刪除數據
- ✅ 所有操作在本地完成

---

## ❓ 常見問題

**Q: 設定保存到哪裡？**  
A: 保存到 Chrome Storage API，如果登錄 Google 會自動跨設備同步

**Q: 如何恢復預設設定？**  
A: 點擊"🔄 重置為預設值"按鈕，之後確認操作

**Q: 能否同時打開兩個頁籤？**  
A: 不能，頁籤是互斥的，但內容會自動保存

**Q: 緩存數據會丟失嗎？**  
A: 當前會話有效，刷新頁面後會清空，可使用匯出功能備份

**Q: 設定文件格式是什麼？**  
A: JSON 格式，可用文本編輯器修改

---

## 📞 技術支持

### 故障排查
1. **頁籤無法切換**
   - 檢查瀏覽器控制台是否有錯誤
   - 刷新頁面重試

2. **設定無法保存**
   - 確認 Chrome Storage 可用
   - 檢查剩余存儲空間

3. **緩存數據無法加載**
   - 確認 Service Worker 運行正常
   - 檢查是否有 API 權限錯誤

---

## 📄 相關文檔

- [cache-history.html 完整說明](CACHE_HISTORY_COMPLETE_SUMMARY.md)
- [cache-history.html 使用指南](CACHE_HISTORY_USAGE.md)
- [快速參考卡](CACHE_HISTORY_REFERENCE.md)

---

**版本**: 1.0  
**創建日期**: 2024-02-27  
**狀態**: ✅ 就緒  
**最後更新**: 2024-02-27
