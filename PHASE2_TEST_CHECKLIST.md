# Phase 2 + 改動 6 測試清單

## 📋 測試項目

### 1. **快取淘汰機制測試** (Phase 2 改動 1-2)
- [ ] 執行超過 50 個不同的查詢
- [ ] 驗證第 51 個查詢後，最老的快取被刪除
- [ ] 檢查 service-worker.js 控制台日誌 (應顯示 `🗑️ 淘汰快取:`)
- [ ] 確認 recentCacheList 中最老的條目被移除

### 2. **存儲使用計算測試** (Phase 2 改動 3)
- [ ] 打開快取歷史頁面
- [ ] 驗證進度條顯示正確百分比
- [ ] 驗證顯示「X.XX MB / 10.00 MB」格式
- [ ] 檢查 console 中 `getStorageUsage()` 的返回值
- [ ] 確認 status 字段值為 'ok' | 'warning' | 'critical'

### 3. **進度條顏色狀態測試** (改動 6)
- [ ] **正常狀態 (0-70%)**：進度條顯示藍色漸變 ✓
- [ ] **警告狀態 (70-90%)**：進度條顯示橙色漸變 ✓
- [ ] **嚴重狀態 (90-100%)**：進度條顯示紅色漸變 ✓
- [ ] 對應的百分比徽章顏色也隨之改變

### 4. **UI 顯示測試** (改動 6)
- [ ] 快取歷史頁面頂部出現「💾 存儲使用情況」區塊
- [ ] 進度條平滑動畫過渡（width 變化）
- [ ] 百分比文字在進度條中央顯示清晰
- [ ] 存儲信息正確格式化（MB 單位、百分比）
- [ ] 響應式設計：窄屏幕上也能正常顯示

### 5. **快取統計信息整合測試** (Phase 2 改動 4-5)
- [ ] 發送 `get_cache_stats` 消息後收到包含 `storage` 字段的響應
- [ ] `stats` 對象包含以下字段：
  - `totalCacheSize` ✓
  - `maxCacheSize: 50` ✓
  - `storage.percentage` ✓
  - `storage.usedMB` ✓
  - `storage.status` ✓

### 6. **邊界情況測試**
- [ ] 快取為空時進度條顯示 0%
- [ ] 快取滿容量時進度條顯示正確百分比
- [ ] 瀏覽器重啟後快取持久化（使用 chrome.storage.local）
- [ ] 清空快取後進度條重置為 0%

### 7. **效能測試**
- [ ] 發送 `get_cache_stats` 請求響應時間 < 100ms
- [ ] 淘汰機制不造成 UI 卡頓
- [ ] 進度條動畫流暢（60 FPS）

### 8. **日誌驗證測試**
- [ ] Service Worker 控制台顯示所有 Phase 2 日誌：
  - `[Gateway] 強制快取大小限制` (超限時)
  - `[Gateway] 🗑️ 淘汰快取` (刪除項目時)
  - `[Gateway] 無法計算存儲使用` (異常時)
- [ ] cache-history.js 發送正確的消息

## 🎯 測試優先級

**高優先級（必須通過）：**
1. 快取淘汰機制正常工作
2. 進度條顏色狀態正確
3. 存儲百分比計算準確
4. 快取歷史頁面顯示新 UI

**中優先級（建議測試）：**
5. 邊界情況處理
6. 響應式設計
7. 效能無影響

**低優先級（可選）：**
8. 詳細日誌驗證

## 📝 測試記錄範本

```
日期：__________
測試者：__________
環境：Chrome v__________

✅ 快取淘汰機制：通過 / 失敗
描述：_______________________________________

✅ 進度條顯示：通過 / 失敗
描述：_______________________________________

✅ 顏色狀態：通過 / 失敗
描述：_______________________________________

✅ 存儲計算：通過 / 失敗
描述：_______________________________________

✅ UI 整合：通過 / 失敗
描述：_______________________________________

總體結果：✅ 通過 / ❌ 失敗 / ⚠️ 有限制條件

備註：_______________________________________
```

## 🔍 故障排除

| 問題 | 解決方案 |
|------|--------|
| 進度條不出現 | 檢查 cache-history.html 中的 ID 是否正確（`storageProgressBar` 等） |
| 百分比為 0% | 驗證 `getStorageUsage()` 是否返回正確的 JSON 大小 |
| 快取未淘汰 | 確認 `enforceCacheSizeLimit()` 在 `putInCache()` 中被調用 |
| 顏色不改變 | 檢查 `.progress-bar.warning` 和 `.critical` CSS 類是否定義 |
| 異步錯誤 | 檢查 `await getCacheStats()` 是否正確使用（改動 5） |

